# 技术架构更新建议

**文档类型**：技术架构更新建议
**版本号**：v1.0
**创建日期**：2026年1月29日
**维护团队**：技术团队

---

## 文档说明

本文档提供了技术架构文档的详细更新建议，以支持数值体系和关卡设计的调整。

---

## 一、更新概述

### 1.1 更新目标

调整技术架构，支持以下新功能：
1. 累积爬升计算和显示
2. 上坡下坡机制
3. 补给需求计算和检查
4. 疲劳休息系统
5. 体能消耗优化

### 1.2 更新范围

- **数据层**：新增数据结构
- **逻辑层**：新增计算模块
- **表现层**：更新UI显示
- **配置层**：新增配置文件

---

## 二、数据层设计

### 2.1 新增数据结构

#### 2.1.1 累积爬升数据

**文件位置**：`scripts/data/elevation_data.gd`

```gdscript
class_name ElevationData
extends Resource

## 累积爬升数据

@export var total_elevation_gain: float = 0.0  # 总累积爬升（米）
@export var current_elevation: float = 0.0     # 当前海拔（米）
@export var base_elevation: float = 0.0        # 基础海拔（米）
@export var uphill_sections: Array[float] = []  # 上坡路段列表
@export var downhill_sections: Array[float] = [] # 下坡路段列表

## 计算累积爬升
func calculate_elevation_gain(terrain_data: TerrainSlopeData) -> float:
    if terrain_data.slope_type in [TerrainSlopeData.SlopeType.GENTLE_UPHILL,
                                   TerrainSlopeData.SlopeType.STEEP_UPHILL,
                                   TerrainSlopeData.SlopeType.CLIFF]:
        total_elevation_gain += terrain_data.elevation_gain
    return total_elevation_gain

## 重置累积爬升
func reset() -> void:
    total_elevation_gain = 0.0
    current_elevation = base_elevation
    uphill_sections.clear()
    downhill_sections.clear()
```

#### 2.1.2 地形坡度数据

**文件位置**：`scripts/data/terrain_slope_data.gd`

```gdscript
class_name TerrainSlopeData
extends Resource

## 地形坡度数据

enum SlopeType {
    FLAT,           # 平坦道路 (0-5%)
    GENTLE_UPHILL,  # 缓坡上坡 (5-15%)
    STEEP_UPHILL,   # 陡坡 (15-30%)
    CLIFF,          # 悬崖栈道 (>30%)
    GENTLE_DOWNHILL,# 缓坡下坡 (-15%到-5%)
    STEEP_DOWNHILL  # 陡坡下坡 (-30%到-15%)
}

@export var slope_type: SlopeType = SlopeType.FLAT
@export var slope_percentage: float = 0.0
@export var elevation_gain: float = 0.0      # 累积爬升（米）
@export var elevation_loss: float = 0.0     # 下降高度（米）
@export var distance: float = 0.0           # 距离（公里）

## 从坡度百分比计算累积爬升
func calculate_elevation_gain_from_slope() -> void:
    if slope_type == SlopeType.FLAT:
        elevation_gain = 0.0
    elif slope_type == SlopeType.GENTLE_UPHILL:
        elevation_gain = distance * (30.0 + (slope_percentage - 5.0) * 2.5)
    elif slope_type == SlopeType.STEEP_UPHILL:
        elevation_gain = distance * (80.0 + (slope_percentage - 15.0) * 13.33)
    elif slope_type == SlopeType.CLIFF:
        elevation_gain = distance * 280.0
    elif slope_type in [SlopeType.GENTLE_DOWNHILL, SlopeType.STEEP_DOWNHILL]:
        elevation_gain = 0.0

## 获取体力消耗乘数
func get_stamina_cost_multiplier() -> float:
    match slope_type:
        SlopeType.FLAT:
            return 1.0
        SlopeType.GENTLE_UPHILL:
            return 1.6
        SlopeType.STEEP_UPHILL:
            return 3.0
        SlopeType.CLIFF:
            return 4.0
        SlopeType.GENTLE_DOWNHILL:
            return 0.8
        SlopeType.STEEP_DOWNHILL:
            return 0.6
        _:
            return 1.0
```

#### 2.1.3 补给需求数据

**文件位置**：`scripts/data/supply_requirement_data.gd`

```gdscript
class_name SupplyRequirementData
extends Resource

## 补给需求数据

@export var water_needed: float = 0.0
@export var sports_drink_needed: float = 0.0
@export var chocolate_needed: float = 0.0
@export var total_eco_value_needed: float = 0.0
@export var current_distance: float = 0.0

## 计算补给需求
func calculate_supply_requirements(distance: float) -> void:
    water_needed = distance / 5.0
    sports_drink_needed = distance / 10.0
    chocolate_needed = distance / 10.0
    total_eco_value_needed = water_needed * 25.0 + sports_drink_needed * 50.0 + chocolate_needed * 75.0
    current_distance = distance

## 检查补给不足
func is_supply_insufficient(water: float, sports_drink: float, chocolate: float) -> bool:
    return water < water_needed or sports_drink < sports_drink_needed or chocolate < chocolate_needed

## 获取不足的补给项
func get_insufficient_items(water: float, sports_drink: float, chocolate: float) -> Array[String]:
    var items: Array[String] = []
    if water < water_needed:
        items.append("矿泉水")
    if sports_drink < sports_drink_needed:
        items.append("运动饮料")
    if chocolate < chocolate_needed:
        items.append("巧克力")
    return items
```

#### 2.1.4 休息数据

**文件位置**：`scripts/data/rest_data.gd`

```gdscript
class_name RestData
extends Resource

## 休息数据

enum RestType {
    QUICK,    # 快速休息
    STANDARD, # 标准休息
    DEEP      # 深度休息
}

@export var rest_count: int = 3
@export var max_rest_count: int = 3
@export var fatigue_accumulated: float = 0.0
@export var last_rest_time: float = 0.0
@export var rest_cooldown: float = 0.0

## 增加疲劳
func add_fatigue(fatigue: float) -> void:
    fatigue_accumulated += fatigue

## 检查是否需要休息
func needs_rest() -> bool:
    return fatigue_accumulated >= 10.0 and rest_count > 0

## 执行休息
func take_rest(rest_type: RestType) -> void:
    if rest_count <= 0:
        return

    match rest_type:
        RestType.QUICK:
            fatigue_accumulated -= 5.0
        RestType.STANDARD:
            fatigue_accumulated -= 10.0
        RestType.DEEP:
            fatigue_accumulated -= 15.0

    rest_count -= 1
    last_rest_time = Time.get_unix_time_from_system()
    rest_cooldown = 60.0  # 1分钟冷却时间

## 检查是否在冷却中
func is_on_cooldown() -> bool:
    return Time.get_unix_time_from_system() - last_rest_time < rest_cooldown

## 重置数据
func reset(max_count: int) -> void:
    rest_count = max_count
    max_rest_count = max_count
    fatigue_accumulated = 0.0
    last_rest_time = 0.0
    rest_cooldown = 0.0
```

---

## 三、逻辑层设计

### 3.1 新增计算模块

#### 3.1.1 累积爬升计算器

**文件位置**：`scripts/logic/elevation_calculator.gd`

```gdscript
class_name ElevationCalculator
extends Node

## 累积爬升计算器

var elevation_data: ElevationData = ElevationData.new()

## 计算累积爬升
func calculate_total_elevation_gain(terrain_sections: Array[TerrainSlopeData]) -> float:
    elevation_data.reset()

    for section in terrain_sections:
        section.calculate_elevation_gain_from_slope()
        elevation_data.calculate_elevation_gain(section)

    return elevation_data.total_elevation_gain

## 获取当前累积爬升
func get_current_elevation_gain() -> float:
    return elevation_data.total_elevation_gain

## 判定地形坡度
func determine_slope_type(slope_percentage: float) -> TerrainSlopeData.SlopeType:
    if slope_percentage >= 30.0:
        return TerrainSlopeData.SlopeType.CLIFF
    elif slope_percentage >= 15.0:
        return TerrainSlopeData.SlopeType.STEEP_UPHILL
    elif slope_percentage >= 5.0:
        return TerrainSlopeData.SlopeType.GENTLE_UPHILL
    elif slope_percentage <= -30.0:
        return TerrainSlopeData.SlopeType.STEEP_DOWNHILL
    elif slope_percentage <= -15.0:
        return TerrainSlopeData.SlopeType.GENTLE_DOWNHILL
    else:
        return TerrainSlopeData.SlopeType.FLAT

## 重置计算器
func reset() -> void:
    elevation_data.reset()
```

#### 3.1.2 补给需求计算器

**文件位置**：`scripts/logic/supply_requirement_calculator.gd`

```gdscript
class_name SupplyRequirementCalculator
extends Node

## 补给需求计算器

var supply_data: SupplyRequirementData = SupplyRequirementData.new()

## 计算补给需求
func calculate_requirements(total_distance: float) -> SupplyRequirementData:
    supply_data.calculate_supply_requirements(total_distance)
    return supply_data

## 检查补给不足
func check_supply_insufficient(inventory: Dictionary) -> bool:
    var water: float = inventory.get("water", 0.0)
    var sports_drink: float = inventory.get("sports_drink", 0.0)
    var chocolate: float = inventory.get("chocolate", 0.0)

    return supply_data.is_supply_insufficient(water, sports_drink, chocolate)

## 获取不足的补给项
func get_insufficient_items(inventory: Dictionary) -> Array[String]:
    var water: float = inventory.get("water", 0.0)
    var sports_drink: float = inventory.get("sports_drink", 0.0)
    var chocolate: float = inventory.get("chocolate", 0.0)

    return supply_data.get_insufficient_items(water, sports_drink, chocolate)

## 获取总环保值需求
func get_total_eco_value_needed() -> float:
    return supply_data.total_eco_value_needed
```

#### 3.1.3 疲劳计算器

**文件位置**：`scripts/logic/fatigue_calculator.gd`

```gdscript
class_name FatigueCalculator
extends Node

## 疲劳计算器

var rest_data: RestData = RestData.new()

## 计算疲劳积累
func calculate_fatigue(distance: float, elevation_gain: float) -> float:
    # 疲劳 = (徒步距离 / 5) + (累积爬升 / 250)
    return (distance / 5.0) + (elevation_gain / 250.0)

## 增加疲劳
func add_fatigue(fatigue: float) -> void:
    rest_data.add_fatigue(fatigue)

## 检查是否需要休息
func needs_rest() -> bool:
    return rest_data.needs_rest()

## 执行休息
func take_rest(rest_type: RestData.RestType) -> void:
    rest_data.take_rest(rest_type)

## 检查是否在冷却中
func is_on_cooldown() -> bool:
    return rest_data.is_on_cooldown()

## 获取当前疲劳值
func get_current_fatigue() -> float:
    return rest_data.fatigue_accumulated

## 重置疲劳系统
func reset(max_rest_count: int) -> void:
    rest_data.reset(max_rest_count)
```

#### 3.1.4 体能消耗计算器

**文件位置**：`scripts/logic/stamina_cost_calculator.gd`

```gdscript
class_name StaminaCostCalculator
extends Node

## 体能消耗计算器

## 计算体能消耗
func calculate_stamina_cost(
    distance: float,
    elevation_gain: float,
    terrain_type: TerrainSlopeData.SlopeType,
    equipment_multiplier: float = 1.0
) -> float:
    # 基础消耗：每公里5点体能
    var base_cost: float = distance * 5.0

    # 累积爬升消耗：每20米1点体能
    var elevation_cost: float = elevation_gain / 20.0

    # 地形乘数
    var terrain_multiplier: float = get_terrain_multiplier(terrain_type)

    # 总消耗
    var total_cost: float = (base_cost + elevation_cost) * terrain_multiplier * equipment_multiplier

    return total_cost

## 获取地形乘数
func get_terrain_multiplier(terrain_type: TerrainSlopeData.SlopeType) -> float:
    match terrain_type:
        TerrainSlopeData.SlopeType.FLAT:
            return 1.0
        TerrainSlopeData.SlopeType.GENTLE_UPHILL:
            return 1.6
        TerrainSlopeData.SlopeType.STEEP_UPHILL:
            return 3.0
        TerrainSlopeData.SlopeType.CLIFF:
            return 4.0
        TerrainSlopeData.SlopeType.GENTLE_DOWNHILL:
            return 0.8
        TerrainSlopeData.SlopeType.STEEP_DOWNHILL:
            return 0.6
        _:
            return 1.0
```

### 3.2 更新现有模块

#### 3.2.1 关卡生成器更新

**文件位置**：`scripts/logic/level_generator.gd`

**更新内容**：
- 支持上坡下坡地形生成
- 确保地形交替合理性
- 生成补给点位置

**关键方法更新**：
```gdscript
## 生成地形序列
func generate_terrain_sequence(total_distance: float, target_elevation: float) -> Array[TerrainSlopeData]:
    var terrain_sections: Array[TerrainSlopeData] = []
    var remaining_distance: float = total_distance
    var remaining_elevation: float = target_elevation
    var consecutive_steep: int = 0  # 防止连续陡坡

    while remaining_distance > 0.0:
        var section: TerrainSlopeData = TerrainSlopeData.new()

        # 确定地形类型
        if consecutive_steep >= 2:
            # 强制下坡或平坦
            section.slope_type = _get_non_steep_slope()
        else:
            section.slope_type = _get_random_slope_type()

        # 计算路段距离
        section.distance = min(remaining_distance, 2.0)  # 每段最大2公里

        # 计算累积爬升
        if section.slope_type in [TerrainSlopeData.SlopeType.GENTLE_UPHILL,
                                 TerrainSlopeData.SlopeType.STEEP_UPHILL,
                                 TerrainSlopeData.SlopeType.CLIFF]:
            section.elevation_gain = min(remaining_elevation, _get_elevation_for_slope(section.slope_type))
            remaining_elevation -= section.elevation_gain
            consecutive_steep += 1
        else:
            section.elevation_gain = 0.0
            consecutive_steep = 0

        terrain_sections.append(section)
        remaining_distance -= section.distance

    return terrain_sections
```

#### 3.2.2 属性管理器更新

**文件位置**：`scripts/logic/attribute_manager.gd`

**更新内容**：
- 支持疲劳系统
- 支持补给影响
- 支持休息恢复

**关键方法更新**：
```gdscript
## 应用疲劳影响
func apply_fatigue(fatigue: float) -> void:
    player_attributes.fatigue += fatigue
    _check_fatigue_thresholds()

## 应用补给
func apply_supply(supply_type: String, amount: float) -> void:
    match supply_type:
        "water":
            player_attributes.thirst += amount * 20.0
        "sports_drink":
            player_attributes.thirst += amount * 15.0
            player_attributes.fatigue -= amount * 5.0
        "chocolate":
            player_attributes.stamina += amount * 15.0
            player_attributes.hunger += amount * 20.0

## 应用休息恢复
func apply_rest_recovery(rest_type: RestData.RestType) -> void:
    match rest_type:
        RestData.RestType.QUICK:
            player_attributes.fatigue -= 5.0
        RestData.RestType.STANDARD:
            player_attributes.fatigue -= 10.0
            player_attributes.stamina += 20.0
        RestData.RestType.DEEP:
            player_attributes.fatigue -= 15.0
            player_attributes.stamina += 30.0
            player_attributes.hunger += 20.0
            player_attributes.thirst += 20.0
```

---

## 四、表现层设计

### 4.1 新增UI组件

#### 4.1.1 累积爬升显示

**文件位置**：`scripts/ui/elevation_display.gd`

```gdscript
class_name ElevationDisplay
extends Control

@onready var _total_elevation_label: Label = $TotalElevationLabel
@onready var _current_elevation_label: Label = $CurrentElevationLabel
@onready var _elevation_bar: ProgressBar = $ElevationBar

## 更新累积爬升显示
func update_elevation_display(total_elevation: float, current_elevation: float) -> void:
    _total_elevation_label.text = str(total_elevation) + "m"
    _current_elevation_label.text = str(current_elevation) + "m"

    var progress: float = (current_elevation / total_elevation) * 100.0 if total_elevation > 0 else 0.0
    _elevation_bar.value = progress
```

#### 4.1.2 补给不足警告UI

**文件位置**：`scripts/ui/supply_warning_ui.gd`

```gdscript
class_name SupplyWarningUI
extends Control

@onready var _warning_panel: Panel = $WarningPanel
@onready var _warning_label: Label = $WarningPanel/WarningLabel
@onready var _confirm_button: Button = $WarningPanel/ConfirmButton

## 显示补给不足警告
func show_supply_warning(insufficient_items: Array[String]) -> void:
    var warning_text: String = "补给不足！缺少：\n"

    for item in insufficient_items:
        warning_text += "- " + item + "\n"

    _warning_label.text = warning_text
    _warning_panel.visible = true

## 隐藏警告
func hide_warning() -> void:
    _warning_panel.visible = false
```

#### 4.1.3 休息UI

**文件位置**：`scripts/ui/rest_ui.gd`

```gdscript
class_name RestUI
extends Control

@onready var _rest_panel: Panel = $RestPanel
@onready var _quick_rest_button: Button = $RestPanel/QuickRestButton
@onready var _standard_rest_button: Button = $RestPanel/StandardRestButton
@onready var _deep_rest_button: Button = $RestPanel/DeepRestButton
@onready var _rest_count_label: Label = $RestPanel/RestCountLabel

signal rest_requested(rest_type: RestData.RestType)

## 显示休息UI
func show_rest_ui(rest_count: int) -> void:
    _rest_count_label.text = "剩余休息次数：" + str(rest_count)
    _rest_panel.visible = true

## 隐藏休息UI
func hide_rest_ui() -> void:
    _rest_panel.visible = false
```

### 4.2 更新现有UI组件

#### 4.2.1 状态栏更新

**更新内容**：
- 添加累积爬升显示
- 添加疲劳显示
- 添加补给状态显示

---

## 五、配置文件设计

### 5.1 新增配置文件

#### 5.1.1 累积爬升配置

**文件位置**：`config/elevation_config.json`

```json
{
  "terrain_slopes": {
    "flat": {
      "slope_range": [0, 5],
      "elevation_gain": 0,
      "stamina_multiplier": 1.0
    },
    "gentle_uphill": {
      "slope_range": [5, 15],
      "elevation_gain_min": 30,
      "elevation_gain_max": 80,
      "stamina_multiplier": 1.6
    },
    "steep_uphill": {
      "slope_range": [15, 30],
      "elevation_gain_min": 80,
      "elevation_gain_max": 280,
      "stamina_multiplier": 3.0
    },
    "cliff": {
      "slope_range": [30, 100],
      "elevation_gain_min": 280,
      "stamina_multiplier": 4.0
    },
    "gentle_downhill": {
      "slope_range": [-15, -5],
      "elevation_loss_min": 30,
      "elevation_loss_max": 80,
      "stamina_multiplier": 0.8
    },
    "steep_downhill": {
      "slope_range": [-30, -15],
      "elevation_loss_min": 80,
      "elevation_loss_max": 280,
      "stamina_multiplier": 0.6
    }
  },
  "mac_lehose_trail": {
    "section_1": {
      "distance": 10.6,
      "elevation_gain": 450
    },
    "section_2": {
      "distance": 13.5,
      "elevation_gain": 550
    },
    "section_3": {
      "distance": 9.8,
      "elevation_gain": 400
    },
    "section_4": {
      "distance": 12.8,
      "elevation_gain": 580
    },
    "section_5": {
      "distance": 10.6,
      "elevation_gain": 450
    },
    "section_6": {
      "distance": 5.2,
      "elevation_gain": 320
    },
    "section_7": {
      "distance": 10.5,
      "elevation_gain": 650
    },
    "section_8": {
      "distance": 9.2,
      "elevation_gain": 420
    },
    "section_9": {
      "distance": 9.6,
      "elevation_gain": 500
    },
    "section_10": {
      "distance": 15.6,
      "elevation_gain": 620
    }
  }
}
```

#### 5.1.2 补给配置

**文件位置**：`config/supply_config.json`

```json
{
  "supply_requirements": {
    "water_per_km": 0.2,
    "sports_drink_per_km": 0.1,
    "chocolate_per_km": 0.1
  },
  "supply_items": {
    "water": {
      "name": "矿泉水",
      "thirst_recovery": 20,
      "eco_value_cost": 25,
      "supply_unit": "瓶"
    },
    "sports_drink": {
      "name": "运动饮料",
      "thirst_recovery": 15,
      "fatigue_recovery": -5,
      "eco_value_cost": 50,
      "supply_unit": "瓶"
    },
    "chocolate": {
      "name": "巧克力",
      "stamina_recovery": 15,
      "hunger_recovery": 20,
      "eco_value_cost": 75,
      "supply_unit": "次"
    },
    "energy_bar": {
      "name": "能量棒",
      "stamina_recovery": 20,
      "hunger_recovery": 15,
      "eco_value_cost": 100,
      "supply_unit": "次"
    },
    "banana": {
      "name": "香蕉",
      "stamina_recovery": 10,
      "potassium_recovery": 20,
      "eco_value_cost": 60,
      "supply_unit": "次"
    },
    "electrolyte_water": {
      "name": "电解质水",
      "thirst_recovery": 30,
      "heart_rate_reduction": -10,
      "eco_value_cost": 80,
      "supply_unit": "瓶"
    },
    "sports_supply_pack": {
      "name": "运动补给包",
      "thirst_recovery": 25,
      "stamina_recovery": 20,
      "fatigue_recovery": -10,
      "eco_value_cost": 150,
      "supply_unit": "次"
    }
  },
  "supply_points": {
    "small": {
      "name": "小型补给点",
      "items": ["water", "energy_bar"],
      "eco_value_cost": 125
    },
    "medium": {
      "name": "中型补给点",
      "items": ["sports_drink", "chocolate"],
      "eco_value_cost": 125
    },
    "large": {
      "name": "大型补给点",
      "items": ["sports_supply_pack", "water"],
      "eco_value_cost": 175
    },
    "super": {
      "name": "超级补给点",
      "items": ["sports_supply_pack", "sports_supply_pack"],
      "photo_card_pack": "basic",
      "eco_value_cost": 300
    }
  }
}
```

#### 5.1.3 休息配置

**文件位置**：`config/rest_config.json`

```json
{
  "rest_limits": {
    "novice": {
      "initial_rest_count": 3,
      "max_rest_count": 3,
      "level_range": [1, 3]
    },
    "standard": {
      "initial_rest_count": 2,
      "max_rest_count": 2,
      "level_range": [4, 6]
    },
    "challenge": {
      "initial_rest_count": 1,
      "max_rest_count": 1,
      "level_range": [7, 11]
    },
    "breakthrough": {
      "initial_rest_count": 0,
      "max_rest_count": 0,
      "level_range": [12, 99]
    }
  },
  "rest_types": {
    "quick": {
      "name": "快速休息",
      "fatigue_recovery": -5,
      "duration": 30
    },
    "standard": {
      "name": "标准休息",
      "fatigue_recovery": -10,
      "stamina_recovery": 20,
      "duration": 60
    },
    "deep": {
      "name": "深度休息",
      "fatigue_recovery": -15,
      "stamina_recovery": 30,
      "hunger_recovery": 20,
      "thirst_recovery": 20,
      "duration": 90
    }
  },
  "breakthrough_mechanics": {
    "equipment": {
      "hiking_boots": {
        "name": "登山靴",
        "fatigue_reduction": 20
      },
      "professional_backpack": {
        "name": "专业背包",
        "fatigue_reduction": 30
      },
      "hiking_poles": {
        "name": "登山杖",
        "rest_recovery_bonus": 20
      }
    },
    "photo_cards": {
      "hiking_master": {
        "name": "登山达人",
        "fatigue_reduction": 25,
        "unlock_requirement": 50
      },
      "hiking_expert": {
        "name": "徒步专家",
        "fatigue_reduction": 50,
        "unlock_requirement": 100
      },
      "triathlon": {
        "name": "铁人三项",
        "fatigue_reduction": 100,
        "stamina_cost_increase": 10,
        "unlock_requirement": 200
      }
    }
  }
}
```

### 5.2 更新现有配置文件

#### 5.2.1 平衡配置更新

**文件位置**：`config/balance_config.json`

**更新内容**：
- 更新体能消耗参数
- 更新疲劳计算参数
- 更新徒步数计算参数

---

## 六、实施建议

### 6.1 实施步骤

**第一阶段：数据层（优先级：高）**
1. 创建新的数据结构类
2. 更新配置文件
3. 单元测试数据结构

**第二阶段：逻辑层（优先级：高）**
1. 实现累积爬升计算器
2. 实现补给需求计算器
3. 实现疲劳计算器
4. 实现体能消耗计算器
5. 更新关卡生成器
6. 更新属性管理器
7. 集成测试

**第三阶段：表现层（优先级：中）**
1. 创建新的UI组件
2. 更新现有UI组件
3. UI集成测试

**第四阶段：整体集成（优先级：高）**
1. 系统集成测试
2. 平衡性调整
3. 性能优化

### 6.2 测试策略

**单元测试**：
- 测试每个计算器的准确性
- 测试数据结构的正确性
- 测试配置加载

**集成测试**：
- 测试计算器之间的交互
- 测试数据流
- 测试UI与逻辑的交互

**系统测试**：
- 测试整个游戏流程
- 测试不同关卡难度
- 测试边界条件

### 6.3 性能考虑

**优化点**：
- 累积爬升计算：预计算并缓存
- 地形生成：使用对象池
- UI更新：限制更新频率

---

## 七、总结

本文档提供了技术架构的详细更新建议，以支持数值体系和关卡设计的调整。主要更新包括：

1. **数据层**：新增4个数据结构类
2. **逻辑层**：新增4个计算器，更新2个现有模块
3. **表现层**：新增3个UI组件，更新1个现有组件
4. **配置层**：新增3个配置文件，更新1个现有文件

所有更新都遵循了现有架构的规范和风格，确保了架构的一致性和可维护性。

---

**文档结束**

技术架构更新建议 v1.0  
**维护团队**：技术团队  
**最后更新**：2026年1月29日
